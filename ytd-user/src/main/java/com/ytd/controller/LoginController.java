package com.ytd.controller;/** * 这里是登录功能模块 * 开发人员：刘梦汝 */import com.ytd.pojo.User;import com.ytd.service.LoginService;import com.ytd.util.AuthImageServlet;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.CrossOrigin;import org.springframework.web.bind.annotation.RequestMapping;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;@Controller@RequestMapping("/goLogin")@CrossOriginpublic class LoginController {    @Autowired    private LoginService loginservice;    /**     * 登录页面     * @return     */    @RequestMapping("/tologin")    public String toregister(){        return "login";    }    /**     * 登录页面     * @return     */    @RequestMapping("/tolist")    public String tolist(){        return "list";    }    /**     * 登录功能     * @param user     * @param session     * @param request     * @param randomCode     * @param passwd     * @return     */    @RequestMapping("/login")    public String login (User user, HttpSession session,HttpServletRequest request,String  randomCode,String passwd){        //后台查询数据        User oneUser =  loginservice.findByMobileAndPassWord(user.getMobile(),passwd);        //打印出oneUser数据        //System.err.println(oneUser.toString());        if(oneUser==null){//判断oneUser为空            System.err.println("oneUser为空");            return "error";        }        if(oneUser.getMobile()==null){//判断手机号为空            System.err.println("手机号为空");            session.setAttribute("imageError","手机号为空");            return "error";        }        if(oneUser.getPasswd()==null){//判断密码为空            System.err.println("密码为空");            session.setAttribute("imageError","请输入正确的密码");            return "error";        }        String rand = (String) session.getAttribute("rand");//图片验证码        //System.err.println(rand);        //System.err.println(randomCode);        if(randomCode==null){//判断图形验证码为空            System.err.println("图形验证码为空");            session.setAttribute("imageError","图形验证码为空");            return "error";        }        if(!rand.equals(randomCode)){//判断图形验证码是否匹配            System.err.println("图形验证码不匹配");            session.setAttribute("imageError","图形验证码不匹配");            return "error";        }        //存入request作用域        request.setAttribute("oneUser",oneUser);        return "list";    }    //刷新验证码    @RequestMapping("/AuthImageServlet")    public void AuthImageServlet (HttpServletRequest request, HttpServletResponse response){        //刷新步骤响应新的验证码去前台         new AuthImageServlet().createImage(request, response);    }}